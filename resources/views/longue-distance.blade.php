 
 <head>
 <script>
        window.Laravel = <?php echo json_encode([
            'csrfToken' => csrf_token(),
        ]); ?>
    </script>
	
	
 
 <link rel="stylesheet" href="https://top-drivers.fr/main/vendor/bootstrap4/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://top-drivers.fr/main/vendor/themify-icons/themify-icons.css">
    <link rel="stylesheet" href="https://top-drivers.fr/main/vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://top-drivers.fr/main/vendor/animate.css/animate.min.css">
    <link rel="stylesheet" href="https://top-drivers.fr/main/vendor/jscrollpane/jquery.jscrollpane.css">
    <link rel="stylesheet" href="https://top-drivers.fr/main/vendor/waves/waves.min.css">
    <link rel="stylesheet" href="https://top-drivers.fr/main/vendor/switchery/dist/switchery.min.css">
    <link rel="stylesheet" href="https://top-drivers.fr/main/vendor/DataTables/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="https://top-drivers.fr/main/vendor/DataTables/Responsive/css/responsive.bootstrap4.min.css">
    <link rel="stylesheet" href="https://top-drivers.fr/main/vendor/DataTables/Buttons/css/buttons.dataTables.min.css">
    <link rel="stylesheet" href="https://top-drivers.fr/main/vendor/DataTables/Buttons/css/buttons.bootstrap4.min.css">
    <link rel="stylesheet" type="text/css" href="https://big-bang-studio.com/neptune/vendor/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/css/bootstrap-editable.css">
    <link rel="stylesheet" href="https://top-drivers.fr/vendor/dropify/dist/css/dropify.min.css">
    <link rel="stylesheet" href="https://top-drivers.fr/main/assets/css/core.css">
	
	</head>
	<!--
	
	<body class="fixed-sidebar fixed-header content-appear skin-default">

    <div class="wrapper">
        <div class="preloader"></div>
        <div class="site-overlay"></div>
		
		<div class="site-content">
		

			

        </div>
    </div>
-->

<!-- Vendor JS -->
    <script type="text/javascript" src="https://top-drivers.fr/main/vendor/jquery/jquery-1.12.3.min.js"></script>
    <script type="text/javascript" src="https://top-drivers.fr/main/vendor/tether/js/tether.min.js"></script>
    <script type="text/javascript" src="https://top-drivers.fr/main/vendor/bootstrap4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://top-drivers.fr/main/vendor/detectmobilebrowser/detectmobilebrowser.js"></script>
    <script type="text/javascript" src="https://top-drivers.fr/main/vendor/jscrollpane/jquery.mousewheel.js"></script>
    <script type="text/javascript" src="https://top-drivers.fr/main/vendor/jscrollpane/mwheelIntent.js"></script>
    <script type="text/javascript" src="https://top-drivers.fr/main/vendor/jscrollpane/jquery.jscrollpane.min.js"></script>
    <script type="text/javascript" src="https://top-drivers.fr/main/vendor/jquery-fullscreen-plugin/jquery.fullscreen-min.js"></script>
    <script type="text/javascript" src="https://top-drivers.fr/main/vendor/waves/waves.min.js"></script>
    <script type="text/javascript" src="https://top-drivers.fr/main/vendor/DataTables/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://top-drivers.fr/main/vendor/DataTables/js/dataTables.bootstrap4.min.js"></script>
    <script type="text/javascript" src="https://top-drivers.fr/main/vendor/DataTables/Responsive/js/dataTables.responsive.min.js"></script>
    <script type="text/javascript" src="https://top-drivers.fr/main/vendor/DataTables/Responsive/js/responsive.bootstrap4.min.js"></script>
    <script type="text/javascript" src="https://top-drivers.fr/main/vendor/DataTables/Buttons/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" src="https://top-drivers.fr/main/vendor/DataTables/Buttons/js/buttons.bootstrap4.min.js"></script>
    <script type="text/javascript" src="https://top-drivers.fr/main/vendor/DataTables/JSZip/jszip.min.js"></script>
    <script type="text/javascript" src="https://top-drivers.fr/main/vendor/DataTables/pdfmake/build/pdfmake.min.js"></script>
    <script type="text/javascript" src="https://top-drivers.fr/main/vendor/DataTables/pdfmake/build/vfs_fonts.js"></script>
    <script type="text/javascript" src="https://top-drivers.fr/main/vendor/DataTables/Buttons/js/buttons.html5.min.js"></script>

    <script type="text/javascript" src="https://top-drivers.fr/main/vendor/DataTables/Buttons/js/buttons.print.min.js"></script>
    <script type="text/javascript" src="https://top-drivers.fr/main/vendor/DataTables/Buttons/js/buttons.colVis.min.js"></script>

    <script type="text/javascript" src="https://top-drivers.fr/main/vendor/switchery/dist/switchery.min.js"></script>
    <script type="text/javascript" src="https://top-drivers.fr/main/vendor/dropify/dist/js/dropify.min.js"></script>
    
    <script type="text/javascript" src="https://top-drivers.fr/main/vendor/bootstrap-colorpicker/dist/js/bootstrap-colorpicker.min.js"></script>
    <script type="text/javascript" src="https://top-drivers.fr/main/vendor/clockpicker/dist/jquery-clockpicker.min.js"></script>    
    <script type="text/javascript" src="https://top-drivers.fr/main/vendor/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
    <script type="text/javascript" src="https://top-drivers.fr/main/vendor/moment/moment.js"></script>
    <script type="text/javascript" src="https://top-drivers.fr/main/vendor/bootstrap-daterangepicker/daterangepicker.js"></script>
	
	
    <!-- Neptune JS -->
    <script type="text/javascript" src="https://top-drivers.fr/main/assets/js/app.js"></script>
    <script type="text/javascript" src="https://top-drivers.fr/main/assets/js/demo.js"></script>
    <script type="text/javascript" src="https://top-drivers.fr/main/assets/js/forms-pickers.js"></script>
    <script type="text/javascript" src="https://top-drivers.fr/main/assets/js/tables-datatable.js"></script>
    <script type="text/javascript" src="https://top-drivers.fr/main/assets/js/forms-upload.js"></script>


    

    <script type="text/javascript" src="https://top-drivers.fr/asset/js/rating.js"></script>    
	


@section('title', 'Map View ')



<div class="col-md-6 map-right">
                <div class="map-responsive" style="padding-bottom: 81.25% !important;">
                     <div id="map" style="width: 100%; height: 430px;"></div>
                </div>                            
            </div>
			
			<div class="site-content">

            

        </div>
    </div>
	
	
<!--			
		@section('content')	

<div class="content-area py-1">
    <div class="container-fluid">
        
        <div class="box box-block bg-white">
            <h5 class="mb-1">Map View</h5>
            <div class="row">
                <div class="col-xs-12">
                    <div id="map"></div>
                    <div id="legend"><h3>Note: </h3></div>
                </div>
            </div>
        </div>
    </div>

</div>

@endsection

-->


@section('styles')
<style type="text/css">
    #map {
        height: 100%;
        min-height: 500px;
    }
    
    #legend {
        font-family: Arial, sans-serif;
        background: rgba(255,255,255,0.8);
        padding: 10px;
        margin: 10px;
        border: 2px solid #f3f3f3;
    }

    #legend h3 {
        margin-top: 0;
        font-size: 16px;
        font-weight: bold;
        text-align: center;
    }

    #legend img {
        vertical-align: middle;
        margin-bottom: 5px;
    }
</style>
@endsection


<script>
    var map;
    var users;
    var providers;
    var ajaxMarkers = [];
    var googleMarkers = [];
	
    var mapIcons = {
        user: '{{ asset("asset/img/marker-user.png") }}',
        active: '{{ asset("asset/img/marker-car.png") }}',
		onboarding: '{{ asset("asset/img/marker-car-assessing.png") }}',
        riding: '{{ asset("asset/img/marker-car.png") }}',
        offline: '{{ asset("asset/img/marker-home.png") }}',
        unactivated: '{{ asset("asset/img/marker-plus.png") }}'
    }

    function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
            center: {lat: 48.5734053, lng: 7.7521113},
            zoom: 9,
            minZoom: 1
        });

        setInterval(ajaxMapData, 3000);
/*
        var legend = document.getElementById('legend');

        var div = document.createElement('div');
        div.innerHTML = '<img src="' + mapIcons['user'] + '"> ' + 'User';
        legend.appendChild(div);

        var div = document.createElement('div');
        div.innerHTML = '<img src="' + mapIcons['offline'] + '"> ' + 'Unavailable Provider';
        legend.appendChild(div);
        
        var div = document.createElement('div');
        div.innerHTML = '<img src="' + mapIcons['active'] + '"> ' + 'Available Provider';
        legend.appendChild(div);
        
        var div = document.createElement('div');
        div.innerHTML = '<img src="' + mapIcons['unactivated'] + '"> ' + 'Unactivated Provider';
        legend.appendChild(div);
        map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(legend);
		*/
        
        google.maps.Map.prototype.clearOverlays = function() {
            for (var i = 0; i < googleMarkers.length; i++ ) {
                googleMarkers[i].setMap(null);
            }
            googleMarkers.length = 0;
        }

    }

    function ajaxMapData() {
       map.clearOverlays();
	   
	  

        $.ajax({
            url: '/map/ajax',
            dataType: "JSON",
           headers: {'X-CSRF-TOKEN': window.Laravel.csrfToken },
            type: "GET",
            success: function(data) {
                //console.log('Ajax Response', data);
				
				ajaxMarkers = data;
				

				
            }
        });
	
	/*	
		function suffisammentGrand(element) {
  return element.service_type_id == 1;
}
var filtre = ajaxMarkers.filter(suffisammentGrand);
*/


//console.log(filtre);

//var elementsInvalides = 0;
//var elementsValides = 0;
//var elementsTotal = 0;

function filtrerParID(obj) {
	//x => x.id === '45'
  // Si c'est un nombre
  
  //var vrai = obj.service => obj.service.status === "active";
  //if (obj.service  ) {
	  //if (obj[['service']['status']] === "active"  ) {
		  var var1 = obj['service'];
		  var var2;
		  if ( typeof var1 !== 'undefined' && typeof var1 !== 'null' && var1 !== null)  {
			  
					var2 = var1['status'];
					//console.log('var2 =',var2);
		  }else{
					var2 = "test";
					//console.log('var1 = ',var1);
		  }
		  
		  
		  //console.log('ecriture 1', var1);
		  //console.log('ecriture 2', var2);
		  if ( var2 === "active"  ) 
			{
						/*elementsValides++;
						elementsTotal++;
						console.log('nbr elements valides ', elementsValides);
						console.log('nbr total ', elementsTotal);*/
						return true;
			} else {
						/*elementsInvalides++
						elementsTotal++;
						console.log('element invalides',elementsInvalides);
						console.log('nbr total ', elementsTotal);*/
						return false;
			}
		  
}

						var arrByID = ajaxMarkers.filter(filtrerParID);

						console.log('Tableau filtr√©\n', arrByID);

		
						arrByID ? arrByID.forEach(addMarkerToMap) : '';

						
}
	
		
		
    function addMarkerToMap(element, index) {
        
        marker = new google.maps.Marker({
            position: {
                lat: element.latitude,
                lng: element.longitude
            },
            //id: element.id,
			id: element.id,
            map: map,
            title: element.first_name + " " +element.last_name,
			
				//icon : mapIcons[element.service ? element.service.status : element.status],
				icon : mapIcons[element.service ? element.service.status : "riding" ],
				//icon : mapIcons.active,
			
            
			
        });

        googleMarkers.push(marker);

        google.maps.event.addListener(marker, 'click', function() {
            window.location.href = '/admin/' + element.service ? 'provider' : 'user' + '/' +element.user_id;
        });
    }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key={{ Setting::get('map_key') }}&libraries=places&callback=initMap" async defer></script>

